import{j as i}from"./motion-B-6xRUo4.js";import{a as s,b as I}from"./leaflet-CO0Iut3d.js";import{e as K}from"./index-885UvVfY.js";import"./charts-ksAtv-L-.js";function J({steps:g,open:r,onClose:E}){const[w,v]=s.useState(0),[y,M]=s.useState(null),x=s.useRef(null),f=s.useRef(null),[n,O]=s.useState({width:0,height:0}),[T,D]=s.useState({width:0,height:0}),C=s.useId(),a=g[w],b=s.useMemo(()=>!r||!a?null:document.querySelector(a.selector),[r,a]),k=s.useCallback(()=>{if(!r||!b){M(null);return}const t=b.getBoundingClientRect();M(t)},[r,b]);if(s.useEffect(()=>{r&&v(0)},[r]),s.useEffect(()=>{r&&k()},[r,k]),s.useEffect(()=>{if(!r)return;const t=()=>k();window.addEventListener("resize",t),window.addEventListener("scroll",t,!0);const o=typeof ResizeObserver<"u"&&b?new ResizeObserver(t):null;return o&&b&&o.observe(b),()=>{window.removeEventListener("resize",t),window.removeEventListener("scroll",t,!0),o?.disconnect()}},[r,k,b]),s.useLayoutEffect(()=>{if(!r||!x.current)return;const t=()=>{if(!x.current)return;const u=x.current.getBoundingClientRect();O({width:u.width,height:u.height})};t();const o=typeof ResizeObserver<"u"?new ResizeObserver(t):null;return o&&x.current&&o.observe(x.current),()=>o?.disconnect()},[r,a]),s.useEffect(()=>{if(!r)return;const t=document.documentElement.style.overflow,o=document.body.style.overflow;document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden";const u=d=>{d.key==="Escape"?(d.preventDefault(),E()):d.key==="ArrowRight"?(d.preventDefault(),v(m=>Math.min(g.length-1,m+1))):d.key==="ArrowLeft"&&(d.preventDefault(),v(m=>Math.max(0,m-1)))};window.addEventListener("keydown",u);const l=d=>{d.preventDefault()};return window.addEventListener("wheel",l,{passive:!1}),window.addEventListener("touchmove",l,{passive:!1}),()=>{window.removeEventListener("keydown",u),window.removeEventListener("wheel",l),window.removeEventListener("touchmove",l),document.documentElement.style.overflow=t,document.body.style.overflow=o}},[r,E,g.length]),s.useEffect(()=>{if(!r)return;const t=()=>Array.from(f.current?.querySelectorAll('button, [href], [tabindex]:not([tabindex="-1"])')??[]).filter(l=>!l.hasAttribute("disabled")),o=l=>{if(l.key!=="Tab")return;const d=t();if(!d.length)return;const m=d[0],B=d[d.length-1];l.shiftKey&&document.activeElement===m?(l.preventDefault(),B.focus()):!l.shiftKey&&document.activeElement===B&&(l.preventDefault(),m.focus())};return document.addEventListener("keydown",o),f.current?.querySelector('[data-tour-action="next"]')?.focus(),()=>document.removeEventListener("keydown",o)},[r,w]),s.useLayoutEffect(()=>{if(!r||!f.current)return;const t=()=>{if(!f.current)return;const u=f.current.getBoundingClientRect();D({width:u.width,height:u.height})};t();const o=typeof ResizeObserver<"u"?new ResizeObserver(t):null;return o&&f.current&&o.observe(f.current),()=>o?.disconnect()},[r]),s.useEffect(()=>{if(!r||!a)return;const t=document.querySelector(a.selector);t&&t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},[r,a]),!r||!a)return null;const p=12,e=y?{x:y.left-p,y:y.top-p,width:y.width+p*2,height:y.height+p*2}:null,R=14,j=typeof window<"u"?window.innerWidth:0,N=typeof window<"u"?window.innerHeight:0,S=a.placement,A=S==="top"||S!=="bottom"&&e&&e.y>=n.height+p*2;let h=e?e.x+e.width/2-n.width/2:j/2-n.width/2;h=Math.min(Math.max(h,16),j-n.width-16);let c;if(e?A?c=e.y-n.height-16:(c=e.y+e.height+16,c+n.height>N-16&&e.y>n.height&&(c=e.y-n.height-16)):c=N/2-n.height/2,c=Math.min(Math.max(c,16),N-n.height-16),e){const t=e.x+e.width,o=h+n.width,u=h<t&&o>e.x,l=c<e.y+e.height&&c+n.height>e.y;if(u&&l){const d=j-t-16,m=e.x-16;d>=n.width?h=t+16:m>=n.width?h=e.x-n.width-16:(c=Math.max(16,e.y-n.height-16),h=Math.min(Math.max(h,16),j-n.width-16))}}const z=N-T.height-24-16;c+n.height>z&&(c=Math.max(16,z-n.height));const L=!e,q=()=>{w===g.length-1?E():v(t=>Math.min(g.length-1,t+1))},H=()=>v(t=>Math.max(0,t-1));return I.createPortal(i.jsxs("div",{className:"fixed inset-0 z-[1000] pointer-events-auto","aria-modal":"true",role:"dialog",children:[i.jsx("svg",{className:"absolute inset-0 h-full w-full pointer-events-none","aria-hidden":!0,focusable:"false",children:i.jsx("defs",{children:i.jsxs("mask",{id:C,children:[i.jsx("rect",{width:"100%",height:"100%",fill:"white"}),!L&&i.jsx("rect",{x:e.x,y:e.y,width:e.width,height:e.height,rx:R,ry:R,fill:"black"})]})})}),i.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:"rgba(8, 8, 8, 0.72)"}}),!L&&i.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute border border-red-400/80 shadow-[0_0_24px_rgba(248,113,113,0.42)]",style:{left:e.x,top:e.y,width:e.width,height:e.height,borderRadius:R},children:i.jsx("div",{className:"pointer-events-none absolute inset-[6px] rounded-[10px] bg-[#120202]/70",style:{borderRadius:Math.max(R-4,6)}})}),i.jsxs("div",{ref:x,className:K("pointer-events-auto absolute max-w-sm rounded-xl border border-red-900/40 bg-black/85 p-4 text-sm text-red-100 shadow-xl backdrop-blur"),style:{left:h,top:c},children:[i.jsxs("div",{className:"flex items-center justify-between gap-3",children:[i.jsx("h2",{className:"text-base font-semibold uppercase tracking-widest",children:a.title}),i.jsxs("span",{className:"text-xs text-red-200/80",children:[w+1,"/",g.length]})]}),i.jsx("div",{className:"mt-2 text-xs text-red-200/80",children:L?"This stepâ€™s target is hidden. Continue to the next step.":a.description})]}),i.jsx("div",{className:"pointer-events-none fixed inset-x-0 bottom-6 flex justify-center",children:i.jsxs("div",{ref:f,className:"pointer-events-auto flex items-center gap-3 rounded-full border border-red-900/50 bg-black/80 px-4 py-2 text-xs text-red-100 shadow-lg backdrop-blur",role:"toolbar",children:[i.jsx("button",{type:"button",onClick:E,className:"rounded-full border border-red-900/40 bg-black/60 px-3 py-1.5 transition hover:bg-red-900/40",children:"Close"}),i.jsx("button",{type:"button",onClick:H,disabled:w===0,className:"rounded-full border border-red-900/40 bg-black/60 px-3 py-1.5 transition enabled:hover:bg-red-900/40 disabled:opacity-40",children:"Back"}),i.jsx("button",{type:"button","data-tour-action":"next",onClick:q,className:"rounded-full border border-red-500/70 bg-red-600/30 px-4 py-1.5 font-semibold uppercase tracking-widest transition hover:bg-red-600/40",children:w===g.length-1?"Finish":"Next"})]})})]}),document.body)}export{J as default};
