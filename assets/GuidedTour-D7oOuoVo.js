import{j as s}from"./motion-B-6xRUo4.js";import{a as i,b as V}from"./leaflet-CO0Iut3d.js";import{e as W}from"./index-CBrnIGBB.js";import"./charts-ksAtv-L-.js";function Q({steps:w,open:n,onClose:k}){const[g,v]=i.useState(0),[p,M]=i.useState(null),x=i.useRef(null),f=i.useRef(null),[r,O]=i.useState({width:0,height:0}),[T,D]=i.useState({width:0,height:0}),S=i.useId(),[A,q]=i.useState(!1);i.useEffect(()=>{if(typeof window>"u")return;const t=typeof window.CSS<"u"&&typeof window.CSS.supports=="function"&&window.CSS.supports("mask-image","url(#tour-mask)");q(t)},[]);const c=w[g],b=i.useMemo(()=>!n||!c?null:document.querySelector(c.selector),[n,c]),E=i.useCallback(()=>{if(!n||!b){M(null);return}const t=b.getBoundingClientRect();M(t)},[n,b]);if(i.useEffect(()=>{n&&v(0)},[n]),i.useEffect(()=>{n&&E()},[n,E]),i.useEffect(()=>{if(!n)return;const t=()=>E();window.addEventListener("resize",t),window.addEventListener("scroll",t,!0);const o=typeof ResizeObserver<"u"&&b?new ResizeObserver(t):null;return o&&b&&o.observe(b),()=>{window.removeEventListener("resize",t),window.removeEventListener("scroll",t,!0),o?.disconnect()}},[n,E,b]),i.useLayoutEffect(()=>{if(!n||!x.current)return;const t=()=>{if(!x.current)return;const u=x.current.getBoundingClientRect();O({width:u.width,height:u.height})};t();const o=typeof ResizeObserver<"u"?new ResizeObserver(t):null;return o&&x.current&&o.observe(x.current),()=>o?.disconnect()},[n,c]),i.useEffect(()=>{if(!n)return;const t=document.documentElement.style.overflow,o=document.body.style.overflow;document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden";const u=d=>{d.key==="Escape"?(d.preventDefault(),k()):d.key==="ArrowRight"?(d.preventDefault(),v(m=>Math.min(w.length-1,m+1))):d.key==="ArrowLeft"&&(d.preventDefault(),v(m=>Math.max(0,m-1)))};window.addEventListener("keydown",u);const l=d=>{d.preventDefault()};return window.addEventListener("wheel",l,{passive:!1}),window.addEventListener("touchmove",l,{passive:!1}),()=>{window.removeEventListener("keydown",u),window.removeEventListener("wheel",l),window.removeEventListener("touchmove",l),document.documentElement.style.overflow=t,document.body.style.overflow=o}},[n,k,w.length]),i.useEffect(()=>{if(!n)return;const t=()=>Array.from(f.current?.querySelectorAll('button, [href], [tabindex]:not([tabindex="-1"])')??[]).filter(l=>!l.hasAttribute("disabled")),o=l=>{if(l.key!=="Tab")return;const d=t();if(!d.length)return;const m=d[0],C=d[d.length-1];l.shiftKey&&document.activeElement===m?(l.preventDefault(),C.focus()):!l.shiftKey&&document.activeElement===C&&(l.preventDefault(),m.focus())};return document.addEventListener("keydown",o),f.current?.querySelector('[data-tour-action="next"]')?.focus(),()=>document.removeEventListener("keydown",o)},[n,g]),i.useLayoutEffect(()=>{if(!n||!f.current)return;const t=()=>{if(!f.current)return;const u=f.current.getBoundingClientRect();D({width:u.width,height:u.height})};t();const o=typeof ResizeObserver<"u"?new ResizeObserver(t):null;return o&&f.current&&o.observe(f.current),()=>o?.disconnect()},[n]),i.useEffect(()=>{if(!n||!c)return;const t=document.querySelector(c.selector);t&&t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},[n,c]),!n||!c)return null;const y=12,e=p?{x:p.left-y,y:p.top-y,width:p.width+y*2,height:p.height+y*2}:null,N=14,R=typeof window<"u"?window.innerWidth:0,j=typeof window<"u"?window.innerHeight:0,z=c.placement,H=z==="top"||z!=="bottom"&&e&&e.y>=r.height+y*2;let h=e?e.x+e.width/2-r.width/2:R/2-r.width/2;h=Math.min(Math.max(h,16),R-r.width-16);let a;if(e?H?a=e.y-r.height-16:(a=e.y+e.height+16,a+r.height>j-16&&e.y>r.height&&(a=e.y-r.height-16)):a=j/2-r.height/2,a=Math.min(Math.max(a,16),j-r.height-16),e){const t=e.x+e.width,o=h+r.width,u=h<t&&o>e.x,l=a<e.y+e.height&&a+r.height>e.y;if(u&&l){const d=R-t-16,m=e.x-16;d>=r.width?h=t+16:m>=r.width?h=e.x-r.width-16:(a=Math.max(16,e.y-r.height-16),h=Math.min(Math.max(h,16),R-r.width-16))}}const B=j-T.height-24-16;a+r.height>B&&(a=Math.max(16,B-r.height));const L=!e,I=()=>{g===w.length-1?k():v(t=>Math.min(w.length-1,t+1))},K=()=>v(t=>Math.max(0,t-1));return V.createPortal(s.jsxs("div",{className:"fixed inset-0 z-[1000] pointer-events-auto","aria-modal":"true",role:"dialog",children:[s.jsx("svg",{className:"absolute inset-0 h-full w-full pointer-events-none","aria-hidden":!0,focusable:"false",children:s.jsx("defs",{children:s.jsxs("mask",{id:S,children:[s.jsx("rect",{width:"100%",height:"100%",fill:"white"}),!L&&s.jsx("rect",{x:e.x,y:e.y,width:e.width,height:e.height,rx:N,ry:N,fill:"black"})]})})}),s.jsx("div",{className:"absolute inset-0 pointer-events-none",style:e&&A?{background:"rgba(6, 6, 6, 0.72)",mask:`url(#${S})`,WebkitMask:`url(#${S})`}:e?{background:"rgba(0, 0, 0, 0.6)"}:{background:"rgba(6, 6, 6, 0.72)"}}),!L&&s.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute border border-red-400/90 shadow-[0_0_24px_rgba(248,113,113,0.6)]",style:{left:e.x,top:e.y,width:e.width,height:e.height,borderRadius:N}}),s.jsxs("div",{ref:x,className:W("pointer-events-auto absolute max-w-sm rounded-xl border border-red-900/40 bg-black/85 p-4 text-sm text-red-100 shadow-xl backdrop-blur"),style:{left:h,top:a},children:[s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsx("h2",{className:"text-base font-semibold uppercase tracking-widest",children:c.title}),s.jsxs("span",{className:"text-xs text-red-200/80",children:[g+1,"/",w.length]})]}),s.jsx("div",{className:"mt-2 text-xs text-red-200/80",children:L?"This stepâ€™s target is hidden. Continue to the next step.":c.description})]}),s.jsx("div",{className:"pointer-events-none fixed inset-x-0 bottom-6 flex justify-center",children:s.jsxs("div",{ref:f,className:"pointer-events-auto flex items-center gap-3 rounded-full border border-red-900/50 bg-black/80 px-4 py-2 text-xs text-red-100 shadow-lg backdrop-blur",role:"toolbar",children:[s.jsx("button",{type:"button",onClick:k,className:"rounded-full border border-red-900/40 bg-black/60 px-3 py-1.5 transition hover:bg-red-900/40",children:"Close"}),s.jsx("button",{type:"button",onClick:K,disabled:g===0,className:"rounded-full border border-red-900/40 bg-black/60 px-3 py-1.5 transition enabled:hover:bg-red-900/40 disabled:opacity-40",children:"Back"}),s.jsx("button",{type:"button","data-tour-action":"next",onClick:I,className:"rounded-full border border-red-500/70 bg-red-600/30 px-4 py-1.5 font-semibold uppercase tracking-widest transition hover:bg-red-600/40",children:g===w.length-1?"Finish":"Next"})]})})]}),document.body)}export{Q as default};
